<!doctype html><html lang=zh-cn>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="noodp">
<title>ng-fundamentals 基础内容查缺补漏 - Ten's Blog</title><meta name=Description content="This is my blog"><meta property="og:title" content="ng-fundamentals 基础内容查缺补漏">
<meta property="og:description" content="组件 @Component({ selector: 'events-app', template: ` <h2>Hello world</h2> <img src=&#34;/assets/images/basic-shield.png&#34;/> ` }) 资源路径相对于 index.html，不能使用静态路径访问文件。 webpack 需要在编译 app 时知道哪一个文件要被捆绑，在 angular.json 中设置：">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.okten.cn/posts/ng-fundamentals-%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B9%E6%9F%A5%E7%BC%BA%E8%A1%A5%E6%BC%8F/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-04-05T10:51:21+08:00">
<meta property="article:modified_time" content="2021-04-05T10:51:21+08:00"><meta property="og:site_name" content="My cool site">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="ng-fundamentals 基础内容查缺补漏">
<meta name=twitter:description content="组件 @Component({ selector: 'events-app', template: ` <h2>Hello world</h2> <img src=&#34;/assets/images/basic-shield.png&#34;/> ` }) 资源路径相对于 index.html，不能使用静态路径访问文件。 webpack 需要在编译 app 时知道哪一个文件要被捆绑，在 angular.json 中设置：">
<meta name=application-name content="Ten's Blog">
<meta name=apple-mobile-web-app-title content="Ten's Blog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://blog.okten.cn/posts/ng-fundamentals-%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B9%E6%9F%A5%E7%BC%BA%E8%A1%A5%E6%BC%8F/><link rel=prev href=https://blog.okten.cn/posts/angular-%E4%B8%AD%E7%9A%84-di/><link rel=next href=https://blog.okten.cn/posts/angular-%E4%B8%AD-rxjs-%E7%9A%84%E5%BA%94%E7%94%A8/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload="this.onload=null,this.rel='stylesheet'">
<noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload="this.onload=null,this.rel='stylesheet'">
<noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"ng-fundamentals 基础内容查缺补漏","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.okten.cn\/posts\/ng-fundamentals-%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B9%E6%9F%A5%E7%BC%BA%E8%A1%A5%E6%BC%8F\/"},"genre":"posts","keywords":"Angular","wordcount":1968,"url":"https:\/\/blog.okten.cn\/posts\/ng-fundamentals-%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B9%E6%9F%A5%E7%BC%BA%E8%A1%A5%E6%BC%8F\/","datePublished":"2021-04-05T10:51:21+08:00","dateModified":"2021-04-05T10:51:21+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Ten Li"},"description":""}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4005185440822195" crossorigin=anonymous></script></head>
<body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark')&&document.body.setAttribute('theme','dark')</script>
<div id=mask></div><div class=wrapper><header class=desktop id=header-desktop>
<div class=header-wrapper>
<div class=header-title>
<a href=/ title="Ten's Blog">Ten's Blog</a>
</div>
<div class=menu>
<div class=menu-inner><a class=menu-item href=/posts/><i class="fas fa-thin fa-archive"></i> 所有文章 </a><a class=menu-item href=/tags/><i class="fas fa-thin fa-tag"></i> 标签 </a><a class=menu-item href=/categories/><i class="fas fa-thin fa-folder-open"></i> 分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search>
<i class="fas fa-search fa-fw" aria-hidden=true></i>
</a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear>
<i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a>
<span class="search-button search-loading" id=search-loading-desktop>
<i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a>
</div>
</div>
</div>
</header><header class=mobile id=header-mobile>
<div class=header-container>
<div class=header-wrapper>
<div class=header-title>
<a href=/ title="Ten's Blog">Ten's Blog</a>
</div>
<div class=menu-toggle id=menu-toggle-mobile>
<span></span><span></span><span></span>
</div>
</div>
<div class=menu id=menu-mobile><div class=search-wrapper>
<div class="search mobile" id=search-mobile>
<input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search>
<i class="fas fa-search fa-fw" aria-hidden=true></i>
</a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear>
<i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a>
<span class="search-button search-loading" id=search-loading-mobile>
<i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span>
</div>
<a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>
Cancel
</a>
</div><a class=menu-item href=/posts/ title><i class="fas fa-thin fa-archive"></i>所有文章</a><a class=menu-item href=/tags/ title><i class="fas fa-thin fa-tag"></i>标签</a><a class=menu-item href=/categories/ title><i class="fas fa-thin fa-folder-open"></i>分类</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a></div>
</div>
</header><div class="search-dropdown desktop">
<div id=search-dropdown-desktop></div>
</div>
<div class="search-dropdown mobile">
<div id=search-dropdown-mobile></div>
</div><main class=main>
<div class=container><div class=toc id=toc-auto>
<h2 class=toc-title>Contents</h2>
<div class=toc-content id=toc-content-auto></div>
</div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">ng-fundamentals 基础内容查缺补漏</h1><div class=post-meta>
<div class=post-meta-line><span class=post-author><a href=https://blog.okten.cn/ title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Ten Li</a></span>&nbsp;<span class=post-category>included in <a href=/categories/frontend/><i class="far fa-folder fa-fw" aria-hidden=true></i>Frontend</a></span></div>
<div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2021-04-05>2021-04-05</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;1968 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;4 minutes&nbsp;</div>
</div><div class="details toc" id=toc-static data-kept>
<div class="details-summary toc-title">
<span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span>
</div>
<div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents>
<ul>
<li><a href=#组件>组件</a></li>
<li><a href=#angular-模板语法>Angular 模板语法</a>
<ul>
<li><a href=#模板变量>模板变量</a></li>
<li><a href=#结构指令>结构指令</a></li>
<li><a href=#ng-绑定-class>ng 绑定 class</a></li>
<li><a href=#ng-绑定-style>ng 绑定 style</a></li>
<li><a href=#模板表达式约束>模板表达式约束</a></li>
</ul>
</li>
<li><a href=#服务>服务</a>
<ul>
<li><a href=#服务-1>服务</a></li>
<li><a href=#引入第三方库>引入第三方库</a></li>
<li><a href=#记录状态>记录状态</a></li>
</ul>
</li>
<li><a href=#路由>路由</a>
<ul>
<li><a href=#路由的步骤>路由的步骤</a></li>
<li><a href=#路由参数>路由参数</a></li>
<li><a href=#html-链接路由>HTML 链接路由</a></li>
<li><a href=#code-导航页面>Code 导航页面</a></li>
<li><a href=#route-guards>Route Guards</a></li>
<li><a href=#active-link>active link</a></li>
<li><a href=#feature-module-或-lazy-loadable-module>feature module 或 lazy loadable module</a></li>
</ul>
</li>
<li><a href=#表单>表单</a>
<ul>
<li><a href=#template-based-form>Template-based Form</a></li>
<li><a href=#model-based-form>Model-based Form</a></li>
<li><a href=#自定义表单验证>自定义表单验证</a></li>
</ul>
</li>
</ul>
</nav></div>
</div><div class=content id=content><h2 id=组件>组件</h2>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=err>@</span><span class=nx>Component</span><span class=p>({</span>
  <span class=nx>selector</span><span class=o>:</span> <span class=s1>&#39;events-app&#39;</span><span class=p>,</span>
  <span class=nx>template</span><span class=o>:</span> <span class=sb>`
</span><span class=sb>    &lt;h2&gt;Hello world&lt;/h2&gt;
</span><span class=sb>    &lt;img src=&#34;/assets/images/basic-shield.png&#34;/&gt;
</span><span class=sb>  `</span>
<span class=p>})</span>
</code></pre></div><p>资源路径相对于 index.html，不能使用静态路径访问文件。</p>
<p>webpack 需要在编译 app 时知道哪一个文件要被捆绑，在 angular.json 中设置：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=s2>&#34;options&#34;</span><span class=err>:</span> <span class=p>{</span>
    <span class=nt>&#34;outputPath&#34;</span><span class=p>:</span> <span class=s2>&#34;dist/ng-fundamentals&#34;</span><span class=p>,</span>
    <span class=nt>&#34;index&#34;</span><span class=p>:</span> <span class=s2>&#34;src/index.html&#34;</span><span class=p>,</span>
    <span class=nt>&#34;main&#34;</span><span class=p>:</span> <span class=s2>&#34;src/main.ts&#34;</span><span class=p>,</span>
    <span class=nt>&#34;polyfills&#34;</span><span class=p>:</span> <span class=s2>&#34;src/polyfills.ts&#34;</span><span class=p>,</span>
    <span class=nt>&#34;tsConfig&#34;</span><span class=p>:</span> <span class=s2>&#34;tsconfig.app.json&#34;</span><span class=p>,</span>
    <span class=nt>&#34;aot&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
    <span class=nt>&#34;assets&#34;</span><span class=p>:</span> <span class=p>[</span>
        <span class=s2>&#34;src/favicon.ico&#34;</span><span class=p>,</span>
        <span class=s2>&#34;src/assets&#34;</span>
    <span class=p>],</span>
</code></pre></div><p>组件需要在模块上注册 angular 才知道去哪里获取组件资源。</p>
<p>组件有一个 class 包含所有组件逻辑和内容。</p>
<h2 id=angular-模板语法>Angular 模板语法</h2>
<h3 id=模板变量>模板变量</h3>
<p><code>#标识符</code> 模板变量可以在模板的任何位置访问：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=p>&lt;</span><span class=nt>event-thumbnail</span> <span class=err>#</span><span class=na>thumbnnail</span> <span class=err>[</span><span class=na>event</span><span class=err>]=&#34;</span><span class=na>events</span><span class=err>&#34;</span> <span class=err>(</span><span class=na>eventClick</span><span class=err>)=&#34;</span><span class=na>handleEventClicked</span><span class=err>($</span><span class=na>event</span><span class=err>)&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>event-thumbnail</span><span class=p>&gt;</span>
<span class=p>&lt;</span><span class=nt>button</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;btn btn-primary&#34;</span> <span class=err>(</span><span class=na>click</span><span class=err>)=&#34;</span><span class=na>thumbnnail</span><span class=err>.</span><span class=na>logFoo</span><span class=err>()&#34;</span><span class=p>&gt;</span>Log me some foo<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</code></pre></div><p>可以在 HTML 中通过组件的模板变量访问子组件中的成员变量和成员方法。</p>
<h3 id=结构指令>结构指令</h3>
<p>* 星号代表结构指令</p>
<p>结构指令改变 DOM 的形状，它不是隐藏 DOM 而是添加或删除 DOM。</p>
<blockquote>
<p>safe navigation operator ?</p>
<p>?. 以这种操作符绑定数据，预防 undefined</p>
</blockquote>
<p>*ngIf 在画面屡次显示隐藏 DOM 时会消耗过大，这时候应该使用 hidden 属性，画面初始化后不变选用 *ngIf。</p>
<h3 id=ng-绑定-class>ng 绑定 class</h3>
<h4 id=class-binding>class binding</h4>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=p>&lt;</span><span class=nt>span</span> <span class=err>[</span><span class=na>class</span><span class=err>.</span><span class=na>green</span><span class=err>]=&#34;</span><span class=na>event</span><span class=err>?.</span><span class=na>time </span><span class=o>=</span><span class=s>==</span> <span class=err>&#39;</span><span class=na>8:00</span> <span class=na>am</span><span class=err>&#39;&#34;</span><span class=p>&gt;</span>{{event?.time}}<span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</code></pre></div><h4 id=ngclass>ngClass</h4>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=p>&lt;</span><span class=nt>span</span> <span class=err>[</span><span class=na>ngClass</span><span class=err>]=&#34;{</span><span class=na>green:</span> <span class=na>event</span><span class=err>?.</span><span class=na>time </span><span class=o>=</span><span class=s>==</span> <span class=err>&#39;</span><span class=na>8:00</span> <span class=na>am</span><span class=err>&#39;,</span> <span class=na>bold:</span> <span class=na>event</span><span class=err>?.</span><span class=na>time </span><span class=o>=</span><span class=s>==</span> <span class=err>&#39;</span><span class=na>8:00</span> <span class=na>am</span><span class=err>&#39;}&#34;</span><span class=p>&gt;</span>{{event?.time}}<span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</code></pre></div><p>ngClass 参数可以是函数，函数返回一个对象 {classKey：boolean,…} 或空格分隔字符串 &lsquo;green bold&rsquo; 或者 class 数组 [&lsquo;green&rsquo; , &lsquo;bold&rsquo;]。</p>
<h3 id=ng-绑定-style>ng 绑定 style</h3>
<h4 id=style-binding>style binding</h4>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=p>&lt;</span><span class=nt>span</span> <span class=err>[</span><span class=na>style</span><span class=err>.</span><span class=na>color</span><span class=err>]=&#34;</span><span class=na>event</span><span class=err>?.</span><span class=na>time </span><span class=o>=</span><span class=s>==</span> <span class=err>&#39;</span><span class=na>8:00</span> <span class=na>am</span><span class=err>&#39;</span> <span class=err>?</span> <span class=err>&#39;#</span><span class=na>003300</span><span class=err>&#39;</span> <span class=na>:</span> <span class=err>&#39;#</span><span class=na>bbb</span><span class=err>&#39;&#34;</span><span class=p>&gt;</span>{{event?.time}}<span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</code></pre></div><h4 id=ngstyle>ngStyle</h4>
<p>[ngStyle] 后面接对象 {三元运算，三元运算}，也可以使用函数返回样式对象。</p>
<h3 id=模板表达式约束>模板表达式约束</h3>
<p>以下内容不允许使用：</p>
<ul>
<li>Assignment（=,+=,==,etc）</li>
<li>new Keyword</li>
<li>Expression Chaining With ;</li>
<li>Global Namespace</li>
</ul>
<p>总结来说就是不允许产生副作用，不允许使用 global 命名空间内的成员。</p>
<h2 id=服务>服务</h2>
<h3 id=服务-1>服务</h3>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=kd>@Injectable</span><span class=p>()</span>
<span class=kr>constructor</span><span class=p>(</span><span class=kr>private</span> <span class=nx>eventService</span>: <span class=kt>EventService</span><span class=p>)</span> <span class=p>{</span>    
<span class=p>}</span>
</code></pre></div><p>这里的实际上是个简写，全文：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=kd>@Injectable</span><span class=p>()</span>
<span class=kr>private</span> <span class=nx>eventService</span>: <span class=kt>EventService</span><span class=p>;</span>
<span class=kr>constructor</span><span class=p>(</span><span class=kr>private</span> <span class=nx>_eventService</span>: <span class=kt>EventService</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>this</span><span class=p>.</span><span class=nx>eventService</span> <span class=o>=</span> <span class=nx>_eventService</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div><p>不要在组件构造函数中添加过多逻辑，应该将逻辑放到生命周期方法中。</p>
<p><code>implements OnInit</code> 是 typeScript，只是语法上严谨，并不是必须的。</p>
<h3 id=引入第三方库>引入第三方库</h3>
<p>引入 toastr 时，在上面声明了一个 toastr ：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=kr>declare</span> <span class=kd>let</span> <span class=nx>toastr</span>: <span class=kt>any</span><span class=p>;</span>
</code></pre></div><p>实际上，在 angular.json 中已经添加了 toastr 的 Js 包，使其在 window 对象中添加了 toaster 变量，我们已经知道了 toastr object 是什么，我们可以直接使用这个对象中的接口，但是 typeScript 编译器不知道，所以只需要声明一个变量，让编译器通过编译即可。</p>
<p>在使用时，不要在使用的组件中直接声明 toastr 对象去使用，这样不容易 mock，不方便单元测试，取而代之的时提供一个可复用的服务。</p>
<p>目前，已经有了 ngx-toastr 库提供了 ToastrServie 接口供 angular 使用。</p>
<h3 id=记录状态>记录状态</h3>
<p>service 还有个功能是记录状态。例如身份认证。</p>
<h2 id=路由>路由</h2>
<p>组件都有 selector 属性，是因为其会被用在 html 的内部，当组件被作为路由使用时，则不需要 selector 属性。</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=kr>import</span> <span class=p>{</span> <span class=nx>Routes</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;@angular/router&#34;</span><span class=p>;</span>
</code></pre></div><p>路由只是一个<strong>数组</strong>配置（它是有序的，从上往下查找匹配路由）,这里导入 Routes 也同样只是为了 typeScript 的静态类型 check。</p>
<p>真正让这个数组奏效的是在模块中通过路由模块的根路由对该数组的载入：</p>
<pre tabindex=0><code class=language-type data-lang=type>RouterModule.forRoot(appRoutes)
</code></pre><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=p>{</span> <span class=nx>path</span><span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=nx>redirectTo</span><span class=o>:</span> <span class=s1>&#39;events&#39;</span><span class=p>,</span> <span class=nx>pathMatch</span><span class=o>:</span> <span class=s1>&#39;full&#39;</span> <span class=p>}</span>
</code></pre></div><p>注意添加默认路由。</p>
<p>pathMatch：path-matching 策略，默认 prefix，还有一个选项是 full</p>
<ul>
<li>prefix 以指定的 path 开始的 URL</li>
<li>full 完全符合指定 path 的 URL</li>
</ul>
<h3 id=路由的步骤>路由的步骤</h3>
<ol>
<li>添加一个 router-outlet</li>
<li>定义路由（一个常量数组）包含一个默认路由</li>
<li>在 module 中使用 RouterModule 载入路由</li>
<li>&lt;base href="/"></li>
</ol>
<h3 id=路由参数>路由参数</h3>
<h4 id=定义参数>定义参数</h4>
<p>冒号提示 Angular 这是一个 URL 参数。</p>
<h4 id=获取参数>获取参数</h4>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=kr>import</span> <span class=p>{</span> <span class=nx>ActivatedRoute</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;@angular/router&#34;</span><span class=p>;</span>
</code></pre></div><p>注入 ActivateRoute service 获取参数。</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=o>+</span><span class=k>this</span><span class=p>.</span><span class=nx>route</span><span class=p>.</span><span class=nx>snapshot</span><span class=p>.</span><span class=nx>params</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span>
</code></pre></div><p>这里获取到的参数是字符串，需要转成 number</p>
<h3 id=html-链接路由>HTML 链接路由</h3>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=p>[</span><span class=nx>routerLink</span><span class=p>]</span><span class=o>=</span><span class=s2>&#34;[&#39;/events&#39;, event.id]&#34;</span>
</code></pre></div><p>[routerLink] 的参数是数组，第一个元素是字符串路由地址，第二个元素是参数。</p>
<h3 id=code-导航页面>Code 导航页面</h3>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=nx>Router</span><span class=p>.</span><span class=nx>navigate</span><span class=p>([</span><span class=s1>&#39;/events&#39;</span><span class=p>,</span> <span class=nx>event</span><span class=p>.</span><span class=nx>id</span><span class=p>])</span>
</code></pre></div><p>参数同上</p>
<h3 id=route-guards>Route Guards</h3>
<p>守卫即可以使用方法，也可以使用服务。</p>
<p>它既可以组织进入某个页面，也可以阻止离开某个页面。</p>
<h4 id=canactivate>canActivate</h4>
<p>通过服务实现 canActivate</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=p>{</span> <span class=nx>path</span><span class=o>:</span> <span class=s1>&#39;events/:id&#39;</span><span class=p>,</span> <span class=nx>component</span>: <span class=kt>EventDetailsComponent</span><span class=p>,</span> <span class=nx>canActivate</span><span class=o>:</span> <span class=p>[</span><span class=nx>EventRouteActivator</span><span class=p>]</span> <span class=p>},</span>
</code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=kd>@Injectable</span><span class=p>()</span>
<span class=kr>export</span> <span class=kr>class</span> <span class=nx>EventRouteActivator</span> <span class=kr>implements</span> <span class=nx>CanActivate</span> <span class=p>{</span>
    <span class=kr>constructor</span><span class=p>(</span><span class=kr>private</span> <span class=nx>eventService</span>: <span class=kt>EventService</span><span class=p>,</span> <span class=kr>private</span> <span class=nx>router</span>: <span class=kt>Router</span><span class=p>)</span> <span class=p>{</span>
    <span class=p>}</span>
    
    <span class=nx>canActivate</span><span class=p>(</span><span class=nx>route</span>: <span class=kt>ActivatedRouteSnapshot</span><span class=p>)</span> <span class=p>{</span>
        <span class=kr>const</span> <span class=nx>eventExists</span> <span class=o>=</span> <span class=o>!!</span><span class=k>this</span><span class=p>.</span><span class=nx>eventService</span><span class=p>.</span><span class=nx>getEvent</span><span class=p>(</span><span class=o>+</span><span class=nx>route</span><span class=p>.</span><span class=nx>params</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]);</span>
        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>eventExists</span><span class=p>)</span>
            <span class=k>this</span><span class=p>.</span><span class=nx>router</span><span class=p>.</span><span class=nx>navigate</span><span class=p>([</span><span class=s1>&#39;/404&#39;</span><span class=p>]);</span>
        <span class=k>return</span> <span class=nx>eventExists</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>canActivate 最后返回 boolean 值。</p>
<h4 id=candeactivate>canDeactivate</h4>
<p>通过方法实现 canDeactivate</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=p>{</span> <span class=nx>path</span><span class=o>:</span> <span class=s1>&#39;events/new&#39;</span><span class=p>,</span> <span class=nx>component</span>: <span class=kt>CreateEventComponent</span><span class=p>,</span> <span class=nx>canDeactivate</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;canDeactivateCreateEvent&#39;</span><span class=p>]</span> <span class=p>},</span>
</code></pre></div><p>方法需要注入 providers，且不能使用缩写:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript>  <span class=nx>providers</span><span class=o>:</span> <span class=p>[</span>
    <span class=p>{</span>
      <span class=nx>provide</span><span class=o>:</span> <span class=s1>&#39;canDeactivateCreateEvent&#39;</span><span class=p>,</span>
      <span class=nx>useValue</span>: <span class=kt>checkDirytState</span>
    <span class=p>}</span>
  <span class=p>]</span>
</code></pre></div><p>useValue 是方法，方法可以放在任何文件里：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=kr>export</span> <span class=kd>function</span> <span class=nx>checkDirytState</span><span class=p>(</span><span class=nx>component</span>: <span class=kt>CreateEventComponent</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>if</span> <span class=p>(</span><span class=nx>component</span><span class=p>.</span><span class=nx>isDirty</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=nb>window</span><span class=p>.</span><span class=nx>confirm</span><span class=p>(</span><span class=s1>&#39;You have not saved this event, do you really want to cancel?&#39;</span><span class=p>)</span>
  <span class=p>}</span>
  <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div><h3 id=active-link>active link</h3>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=p>&lt;</span><span class=nt>a</span> <span class=err>[</span><span class=na>routerLink</span><span class=err>]=&#34;[&#39;/</span><span class=na>events</span><span class=err>&#39;]&#34;</span> <span class=na>routerLinkActive</span><span class=o>=</span><span class=s>&#34;active&#34;</span> <span class=err>[</span><span class=na>routerLinkActiveOptions</span><span class=err>]=&#34;{</span><span class=na>exact:true</span><span class=err>}&#34;</span><span class=p>&gt;</span>All Events<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</code></pre></div><p>routerLinkActive=&ldquo;active&rdquo; 添加在含有 routerlink 的标签上，当路由与标签指定的路由匹配，则添加 active class。</p>
<p>默认匹配路由字符串策略是 start with。</p>
<p>添加 <code> [routerLinkActiveOptions]="{exact:true}"</code> 是完全符合。</p>
<h3 id=feature-module-或-lazy-loadable-module>feature module 或 lazy loadable module</h3>
<p>与 appModule 的区别：</p>
<ol>
<li>不导入 BrowserModule</li>
<li>导入的 RouterModule 调用 forChild 方法</li>
</ol>
<h2 id=表单>表单</h2>
<p>分为两种：</p>
<ol>
<li>Template-based</li>
<li>Model-based 也称 reactive forms</li>
</ol>
<p>表单如果都通过事件绑定的方式太复杂，所以引入 ngModel。</p>
<p>[(ngModel)] 双向绑定使用双括号 banana box</p>
<p>使用时根据需要决定如何绑定。</p>
<h3 id=template-based-form>Template-based Form</h3>
<p>需要引入 FormsModule 注册到 module 中。</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=p>&lt;</span><span class=nt>form</span> <span class=err>#</span><span class=na>loginForm</span><span class=o>=</span><span class=s>&#34;ngForm&#34;</span> <span class=err>(</span><span class=na>ngSubmit</span><span class=err>)=&#34;</span><span class=na>login</span><span class=err>(</span><span class=na>loginForm</span><span class=err>.</span><span class=na>value</span><span class=err>)&#34;</span> <span class=na>autocomplete</span><span class=o>=</span><span class=s>&#34;off&#34;</span><span class=p>&gt;</span>
	<span class=p>&lt;</span><span class=nt>input</span> <span class=err>(</span><span class=na>ngModel</span><span class=err>)=&#34;</span><span class=na>userName</span><span class=err>&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;userName&#34;</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;userName&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;form-control&#34;</span> <span class=na>placeholder</span><span class=o>=</span><span class=s>&#34;User Name...&#34;</span> <span class=p>/&gt;</span>
<span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span>
</code></pre></div><p>通过模板变量声明 Form，<code>#loginForm="ngForm"</code> 指定该 Form 为 Angular 表单。</p>
<p>使用 ngSubmit 提交，参数是模板变量的值 <code>loginForm.value</code>。</p>
<p>用 name 声明 Form 中的成员属性。</p>
<h4 id=表单验证>表单验证</h4>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=p>&lt;</span><span class=nt>em</span> <span class=err>*</span><span class=na>ngIf</span><span class=o>=</span><span class=s>&#34;newEventForm.controls.date?.invalid &amp;&amp; (newEventForm.controls.date?.touched)&#34;</span><span class=p>&gt;</span>Required<span class=p>&lt;/</span><span class=nt>em</span><span class=p>&gt;</span>
</code></pre></div><p>基于模板的表单验证特别长，因为 formControl 不是 public 类型，它是 Form 的属性，所以在表单验证时特别繁琐。</p>
<h3 id=model-based-form>Model-based Form</h3>
<p>还需要引入 ReactiveFormsModule 注册到 module 中。</p>
<p>步骤如下：</p>
<ol>
<li>创建每个 FormControl</li>
<li>创建一个 FormGroup</li>
<li>为 FormGroup 配置 FormControl</li>
<li>给 HTML 中的 form 绑定 FormGroup</li>
<li>给 HTML 中的 field 绑定 FormControlName</li>
</ol>
<p>formControlName 绑定时不需要带任何括号，只是指定属性名</p>
<h4 id=表单验证-1>表单验证</h4>
<p>表单验证是 FormControl 的第二个参数：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=kd>let</span> <span class=nx>firstName</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>FormControl</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>auth</span><span class=p>.</span><span class=nx>currentUser</span><span class=p>.</span><span class=nx>firstName</span><span class=p>,</span> <span class=nx>Validators</span><span class=p>.</span><span class=nx>required</span><span class=p>);</span>
</code></pre></div><p>如果有多个验证使用数组。</p>
<h3 id=自定义表单验证>自定义表单验证</h3>
<h4 id=validator-是什么>validator 是什么</h4>
<p>validator 就是一个函数：</p>
<ul>
<li>返回 null 时 valid</li>
<li>返回 error 对象时 invalid</li>
</ul>
<p>error 对象 { key: value }</p>
<h4 id=自定义表单验证方法>自定义表单验证方法</h4>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=kr>export</span> <span class=kd>function</span> <span class=nx>restrictedWords</span><span class=p>(...</span><span class=nx>words</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>return</span> <span class=p>(</span><span class=nx>control</span>: <span class=kt>FormControl</span><span class=p>)</span><span class=o>:</span> <span class=p>{</span> <span class=p>[</span><span class=nx>key</span>: <span class=kt>string</span><span class=p>]</span><span class=o>:</span> <span class=kt>any</span> <span class=p>}</span> <span class=o>=&gt;</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>words</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>let</span> <span class=nx>invalidWords</span> <span class=o>=</span> <span class=nx>words</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>w</span> <span class=o>=&gt;</span> <span class=nx>control</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>w</span><span class=p>)</span> <span class=o>?</span> <span class=nx>w</span> : <span class=kt>null</span><span class=p>)</span>
      <span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>w</span> <span class=o>=&gt;</span> <span class=nx>w</span> <span class=o>!==</span> <span class=kc>null</span><span class=p>);</span>
    <span class=k>return</span> <span class=nx>invalidWords</span> <span class=o>&amp;&amp;</span> <span class=nx>invalidWords</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>0</span>
      <span class=o>?</span> <span class=p>{</span> <span class=s1>&#39;restrictedWords&#39;</span><span class=o>:</span> <span class=nx>invalidWords</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=s1>&#39;, &#39;</span><span class=p>)</span> <span class=p>}</span>
      <span class=o>:</span> <span class=kc>null</span><span class=p>;</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>这里为了使用 FormControl 使用了闭包。</p>
<p>注意 key 值 <code>restrictedWords</code> 与方法名一致。</p>
</div><div class=post-footer id=post-footer>
<div class=post-info>
<div class=post-info-line>
<div class=post-info-mod>
<span>Updated on 2021-04-05</span>
</div></div>
<div class=post-info-line>
<div class=post-info-md></div>
<div class=post-info-share>
<span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://blog.okten.cn/posts/ng-fundamentals-%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B9%E6%9F%A5%E7%BC%BA%E8%A1%A5%E6%BC%8F/ data-title="ng-fundamentals 基础内容查缺补漏" data-hashtags=Angular><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://blog.okten.cn/posts/ng-fundamentals-%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B9%E6%9F%A5%E7%BC%BA%E8%A1%A5%E6%BC%8F/ data-hashtag=Angular><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://blog.okten.cn/posts/ng-fundamentals-%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B9%E6%9F%A5%E7%BC%BA%E8%A1%A5%E6%BC%8F/ data-title="ng-fundamentals 基础内容查缺补漏"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://blog.okten.cn/posts/ng-fundamentals-%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B9%E6%9F%A5%E7%BC%BA%E8%A1%A5%E6%BC%8F/ data-title="ng-fundamentals 基础内容查缺补漏"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.0.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://blog.okten.cn/posts/ng-fundamentals-%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B9%E6%9F%A5%E7%BC%BA%E8%A1%A5%E6%BC%8F/ data-title="ng-fundamentals 基础内容查缺补漏"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span>
</div>
</div>
</div>
<div class=post-info-more>
<section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/angular/>Angular</a></section>
<section>
<span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span>
</section>
</div>
<div class=post-nav><a href=/posts/angular-%E4%B8%AD%E7%9A%84-di/ class=prev rel=prev title="Angular 中的 DI"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Angular 中的 DI</a>
<a href=/posts/angular-%E4%B8%AD-rxjs-%E7%9A%84%E5%BA%94%E7%94%A8/ class=next rel=next title="Angular 中 RXJS 的应用">Angular 中 RXJS 的应用<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div>
</div>
</article></div>
</main><footer class=footer>
<div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2020 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://blog.okten.cn/ target=_blank>Ten Li</a></span>&nbsp;|&nbsp;<span class=license><a rel=‘license external nofollow noopener noreffer’ href=‘https://creativecommons.org/licenses/by-nc/4.0/’ target=‘_blank’>CC BY-NC 4.0</a></span></div>
</div>
</footer></div>
<div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top">
<i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments">
<i class="fas fa-comment fa-fw" aria-hidden=true></i>
</a>
</div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},search:{algoliaAppID:"OOS30TQZ13",algoliaIndex:"my_blog",algoliaSearchKey:"fe316b1e710c67a296e3ca697159b8f7",highlightTag:"em",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-SHZBTMBMCF',{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-SHZBTMBMCF" async></script></body>
</html>